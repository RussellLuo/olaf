server:
  listen:
  - :6666
  before_responses:
  - methods: # Write a 200 status with an empty body for all health checks
    - GET
    paths:
    - /health-check
  after_responses:
  - status_code: 404 # Write a 404 status with an empty body for all unmatched routes

services:
- name: production
  url: localhost:2222
  dial_timeout: 5s
  max_requests: 100
  routes:
  - hosts:
    - example.com
    paths:
    - /api/foo # original path from the client
    # final path to service `production`: /v1/foo
    strip_prefix: /api
    target_path: /v1$ # `$` represents the request path, which is /foo here
  - hosts:
    - example.com
    paths:
    # `~:` represents a regex path
    - ~:^/bar/\w+ # samples: /bar/1 or /bar/word
    plugins:
    - type: canary
      config:
        # path "/bar/1?tid=5" will be routed to service `staging`
        key: query.tid
        type: int
        whitelist: $ > 0 && $ <= 10 # `$` represents the value of tid
        upstream: staging

- name: staging
  url: localhost:3333
  dial_timeout: 5s
  max_requests: 100
